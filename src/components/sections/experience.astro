---
import { getCollection } from 'astro:content'
import dayjs from 'dayjs'
import Section from '~/components/layout/section.astro'
import JobExperience from '~/components/ui/job-experience.astro'

const experiences = await getCollection('experience')
const sortedExperiences = experiences.toSorted((a, b) =>
  dayjs(b.data.startDate).isAfter(dayjs(a.data.startDate)) ? 1 : -1
)
---

<Section id="experience">
  <h2 class="text-2xl md:text-3xl font-bold mb-8">Experience</h2>

  <div class="space-y-12">
    {
      sortedExperiences.map(async (experience) => {
        const { Content } = await experience.render()
        return (
          <div class="relative pl-6 border-l-2 border-black/20 dark:border-white/20">
            <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-black dark:bg-white" />
            <JobExperience {...experience.data} />
            <div class="mt-4 prose prose-sm dark:prose-invert dark:prose-p:text-gray-400 prose-p:text-gray-600">
              <Content />
            </div>
          </div>
        )
      })
    }
  </div>
</Section>
