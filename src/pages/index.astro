---
import Layout from '~/components/layout.astro'
import * as home from '~/home.md'
import { sortDates } from '~/utils/sort-dates'

const formatDate = (dateString: string) => {
	const date = new Date(dateString)

	if (date.getTime() - Date.now() > 0) {
		return 'Present'
	}

	return date.getFullYear()
}

const timeline = await Astro.glob('../timeline/*.md')
// sort timeline with most recent first
const sortedTimeline = timeline.sort((a, b) => {
	return sortDates(b.frontmatter.startDate, a.frontmatter.startDate)
})
---

<Layout>
	<main class="max-w-prose">
		<div
			class="mt-3 prose dark:prose-invert dark:prose-headings:text-white dark:prose-p:text-gray-300 dark:prose-li:text-gray-300 dark:prose-a:text-gray-200 dark:prose-a:hover:text-white"
		>
			<h1 class="text-2xl">{home.frontmatter.title}</h1>

			<home.Content />

			<h3>Links</h3>

			<div class="flex gap-2">
				<a
					href="https://github.com/casperengl/"
					class="dark:text-gray-200 dark:hover:text-white"
					target="_blank"
					rel="noopener noreferrer"
				>
					<svg
						viewBox="0 0 32 32"
						aria-label="Github"
						class="w-10 h-10"
						astro-icon="carbon:logo-github"
						><path
							fill="currentColor"
							fill-rule="evenodd"
							d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45 3 3 0 0 0 4.08 1.16 2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76 5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7 5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z"
						></path>
					</svg>
				</a>

				<a
					href="https://www.linkedin.com/in/casperengl/"
					class="dark:text-gray-200 dark:hover:text-white"
					target="_blank"
					rel="noopener noreferrer"
				>
					<svg
						viewBox="0 0 32 32"
						aria-label="LinkedIn"
						class="w-10 h-10"
						astro-icon="carbon:logo-linkedin"
						><path
							fill="currentColor"
							d="M26.2 4H5.8C4.8 4 4 4.8 4 5.7v20.5c0 .9.8 1.7 1.8 1.7h20.4c1 0 1.8-.8 1.8-1.7V5.7c0-.9-.8-1.7-1.8-1.7zM11.1 24.4H7.6V13h3.5v11.4zm-1.7-13c-1.1 0-2.1-.9-2.1-2.1 0-1.2.9-2.1 2.1-2.1 1.1 0 2.1.9 2.1 2.1s-1 2.1-2.1 2.1zm15.1 12.9H21v-5.6c0-1.3 0-3.1-1.9-3.1S17 17.1 17 18.5v5.7h-3.5V13h3.3v1.5h.1c.5-.9 1.7-1.9 3.4-1.9 3.6 0 4.3 2.4 4.3 5.5v6.2z"
						></path>
					</svg>
				</a>

				<a
					href="https://twitter.com/casperengl"
					class="dark:text-gray-200 dark:hover:text-white"
					target="_blank"
					rel="noopener noreferrer"
				>
					<svg
						viewBox="0 0 32 32"
						aria-label="Twitter"
						class="w-10 h-10"
						astro-icon="carbon:logo-twitter"
						><path
							fill="currentColor"
							d="M11.92 24.94A12.76 12.76 0 0 0 24.76 12.1v-.59A9.4 9.4 0 0 0 27 9.18a9.31 9.31 0 0 1-2.59.71 4.56 4.56 0 0 0 2-2.5 8.89 8.89 0 0 1-2.86 1.1 4.52 4.52 0 0 0-7.7 4.11 12.79 12.79 0 0 1-9.3-4.71 4.51 4.51 0 0 0 1.4 6 4.47 4.47 0 0 1-2-.56v.05a4.53 4.53 0 0 0 3.55 4.45 4.53 4.53 0 0 1-2 .08A4.51 4.51 0 0 0 11.68 21a9.05 9.05 0 0 1-5.61 2A9.77 9.77 0 0 1 5 22.91a12.77 12.77 0 0 0 6.92 2"
						></path>
					</svg>
				</a>
			</div>

			<h3>Experience</h3>

			<ul class="mt-6 space-y-3">
				{sortedTimeline.map(
					({
						frontmatter: { endDate, startDate, role, company, link, linkTitle },
					}) => (
						<li>
							<div class="flex flex-col items-start">
								{endDate ? (
									<span>
										{formatDate(startDate)} &mdash; {formatDate(endDate)}
									</span>
								) : (
									<span>{formatDate(startDate)} to date</span>
								)}
								<span>
									{role} @{' '}
									{link ? (
										<a
											href={link}
											rel="noopener noreferrer"
											target="_blank"
											title={linkTitle}
										>
											{company}
										</a>
									) : (
										company
									)}
								</span>
							</div>
						</li>
					)
				)}
			</ul>
		</div>
	</main>
</Layout>
